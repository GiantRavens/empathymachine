# empathy machine configuration

## choose a proxy address - use 127.0.0.1 for local-only, or 0.0.0.0 to listen on all interfaces for LAN clients
bind_addr: "127.0.0.1:8080"

## define blocklists - each hosts-format file contributes domains to both the HTTP proxy and DNS sinkhole
## one entry per line, comments start with '#'
## use blocklists/custom.txt for local overrides (never overwritten), plus any subscribed lists you refresh

  # examples of popular hosts-format lists you can download:
  # - "blocklists/stevenblack_hosts.txt"        # StevenBlack consolidated hosts
  # - "blocklists/oisd_basic.txt"              # OISD basic blocklist (ads + trackers)
  # - "blocklists/1hosts_pro.txt"              # 1Hosts Pro (privacy-focused)

blocklists:
  - "blocklists/custom.txt"

## define hosts that should bypass TLS interception (plain domains or wildcard prefixes like *.icloud.com)
## bypassed hosts are allowed through untouched, even if the DNS sinkhole is enabled
tls:
  enable_intercept: true
  ca_dir: certs
  upstream_insecure: false
  bypass_hosts:
  #  - "example.com"

## DNS sinkhole configuration
dns:
  enable: true
  # bind 127.0.0.1 for local-only DNS; switch to 0.0.0.0 to serve other devices on your LAN
  bind_addr: "127.0.0.1:8053"
  
  # all domains gathered from the blocklists above (local + subscribed) are answered with 0.0.0.0/:: here
  # allowed domains are forwarded to these upstream resolvers (supports udp/tcp/tls/https)
  upstreams:
    - address: "1.1.1.1:853"
      transport: tls
      dns_name: "cloudflare-dns.com"

## optional remote sources EmpathyMachine can fetch and place into blocklists/
## each entry downloads from `url` and writes to `destination`
sources:
  - url:         "https://raw.githubusercontent.com/StevenBlack/hosts/refs/heads/master/hosts"
    destination: "blocklists/stevenblack_hosts.txt"
    # etag_path and last_modified_path default beside destination but can be overridden:
    # etag_path: "blocklists/stevenblack_hosts.txt.etag"
    # last_modified_path: "blocklists/stevenblack_hosts.txt.last_modified"

## specify on the fly rewrites for all sites, or by host names - watch indentation!
## rewrite actions are applied in remove, replace, css order each time a matching HTML response is intercepted.
## global settings
rewrites:
  remove:
    - "iframe"
    - "script[src=\"adsandtrackingareawesome.com\"]"
  replace:
    - find: "utilize"
      replace: "use"
  css:
    - ".annoying-popup { display: none !important; }"

  ## per-host settings
  hosts:
    example.com:
      remove:
        - "#TerribleWidget"
        - 'iframe[src*="myaccount.example.com/auth/iframe"]'
      replace:
      css:
        - "#AnnoyingWidget { display: none !important; }"
